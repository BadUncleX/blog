---
layout: post
title:  " 51%攻击是如何发生的 "
date:   2018-05-22 11:34:02 +0800
categories: blockchain 双花
typora-copy-images-to: ../assets/images/2018-05
typora-root-url: ../../blog_alexcode
---

# 51%攻击是如何发生的

![](/assets/images/2018-05/2018-06-12-150703.jpg)



51%攻击, 或者叫双花攻击,就是旷工们试图将他们的加密货币花费两次.  "两次花费"货币, "双花"由此得名. 



举例来说, 我拿10个比特币购买了一辆豪华轿车, 几天之后汽车交付送到我家, 我的比特币也从我手里转移到汽车公司了. 通过51%攻击我可以尝试反转这笔交易, 如果我成功了我付出的钱又回到我手里, 但是我却白白的多了一辆车, 是不是看起来爽呆了?  这可不像支付宝, 你退货了是货款两清, 双花的效果是只退款不退货. 



## 区块链 = 自治

在讨论51%攻击之前 ,我们首先要明白区块链协议是自治的. 区块链就是我们整个交易的一个账本, 有了这个账本我们就不需要其他第三方帮我们记账, 所以我们不需要政府也不需要银行.  所以, 区块链的特点就是去中心化的.  区块链是民主自治的, 即是由矿工们通过共识来共同治理的. 



## 51%攻击是如何发生的

交易经由比特币拥有者签名后会被放入未确认交易池中, 矿工们从交易池中选择交易来构建一个交易的区块. 



为了能够将由交易构成的区块加入到区块链中, 矿工们需要利用他们的算力来解答复杂的数学题.  算力越大获得的机会越多. 

一旦旷工找到了问题的解, 就会立即将此消息广播给其他旷工, 其他旷工收到消息后经过验证发现符合共识的规则, 则接受这一个区块. 

注意, 任何人, 包括那些故意使坏的旷工,都没有能力为其他人创建交易, 因为交易需要所有者的私钥签名. 所以, 从别人的账户中发送比特币是不可能的. 



## 秘密挖矿-- 创建区块链的后代

恶意旷工要做的就是尝试翻转现有的交易.  正常情况下, 当旷工获得计算的解时,他们会丽江将消息广播给其他所有旷工, 这样就能获得全网认可并将此区块添加到大家认可的区块链中. 

但是, 一个故意使坏的恶意旷工会选择不向网络广播的方式来创建一条新的区块链后代.  现在有了两个版本的区块链. 

![下面是一个坏人新建了一个不广播的区块链](/assets/images/2018-05/2018-06-12-142541.png)



上面一个版本是正常版本, 由正常的旷工们共同遵循的版本, 下面一个版本则是恶意旷工所遵循的版本.  恶意旷工秘密创建自己的区块链, 并且不向全网公布他创建成功的消息, 因为他如果发布是不能被其他人接受的, 因为他的区块链版本不是最长的.  所以, 恶意版本的区块链实际是从网络中隔离了. 



![](/assets/images/2018-05/2018-06-12-143205.png)

现在, 恶意旷工在上面的正常版本里将手里的比特币全部花出去买了一辆兰博基尼, 同时, 他没有将相关交易包含在自己新建的恶意版本的区块链中, 也就是说, 在恶意版本的区块链中, 他的比特币还没有花. 



![](/assets/images/2018-05/2018-06-12-143439.png)

现在, 比赛开始了. 游戏的规则很简单, 谁的链长谁赢. 换句话说, 区块链的共识就是, 谁的链长大家就认为他的链是有效真实的.  恶意旷工开始在他的隔离版本的区块链里发力, 使用比上面区块链更前的算力快马加鞭的搭建区块,  因为他的算力更强, 很快他的链就变成最长的那条链了. 



## 竞赛 -- 公布新链, 废弃旧链

![](/assets/images/2018-05/2018-06-12-144225.png)

恶意旷工的运算速度超过其他的旷工, 他增加区块的速度也超过其他旷工, 不久, 恶意旷工的区块的长度超过了上面的那条区块链.  其他旷工在接收到这条广播消息后经过检查, 艹, 这个哥们的区块链确实是全网最长的, 好吧, 按照共识协议, 大家只能强制切换到恶意旷工建的这条链. 



![](/assets/images/2018-05/2018-06-12-144308.png)



恶意旷工构建的区块链现在已经被全网认可为真实有效的区块链了, 然后悲剧就来了, 所有不在恶意旷工构建的区块链里的所有交易全部回滚. 

攻击者之前在上面的一条区块链里用比特币购买了兰博基尼, 现在他在新的区块链里可以重新使用这些比特币. 



**这就是双花攻击.**  通常也被称为51%攻击, 因为恶意旷工需要有战友全网51%的算力才能成功实施攻击去构建一个更长的区块链. 



## 那么, 比特币如何抵御51%攻击呢?

在现实中这类攻击很难实施.  如前说述, 恶意旷工需要超过全网其他旷工的算力才能达成.  试想一下, 比特币的区块链里有不计其数的旷工, 恶意旷工需要花费巨大的经济代价去购买挖矿硬件去和全网算力竞争.  地球上即使是最强悍的计算机也不能直接和全网的算力直接竞争.  并且, 还要冒着被抓和制裁的风险, 毕竟购买兰博基尼还是容易被人肉出来的. 



## 其他区块链是否更脆弱?

尽管51%攻击很难, 但是事实上过去确实有不少51%的攻击真的发生了.  就在2018年4月份的Verge区块链上就发生了一次51%攻击.  在这次攻击中, 攻击者利用了Verge区块链协议的一个bug, 该bug可以允许攻击者以相当快的速度创建新的区块, 最终使攻击者在很短时间内就创建了更长版本的Verge区块链.  所以, 这里的51%攻击其实并不是真的算力强, 而仅仅是因为bug本身产生的漏洞. 

一个优秀的区块链开发团队会非常注意这类bug的发生以防被利用. 



当然, 对于POW共识算法来说, 那些相对较小规模的区块链实际是更脆弱而容易被攻击, 因为他们的全网算力本身就不足够大, 对于攻击者来说攻击的代价就比较小而容易得逞.  这也是为什么在51%攻击通常发生在比较小的区块链身上的原因. 

比特币区块链到目前为止从来没有遭受过51%攻击. 



> 本文参考翻译自: [Medium Coinmonks](https://medium.com/coinmonks/what-is-a-51-attack-or-double-spend-attack-aa108db63474)